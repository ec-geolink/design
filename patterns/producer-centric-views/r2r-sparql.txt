PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX xml: <http://www.w3.org/XML/1998/namespace>
PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX dcterms: <http://purl.org/dc/terms/>
PREFIX foaf: <http://xmlns.com/foaf/0.1/>
PREFIX geosparql: <http://www.opengis.net/ont/geosparql#>
PREFIX skos: <http://www.w3.org/2004/02/skos/core#>
PREFIX ecgl: <http://schema.geolink.org/1.0/>
PREFIX ecglview: <http://schema.geolink.org/view/1.0/>
PREFIX ecglvoc: <http://schema.geolink.org/voc/1.0/>

## If some triple in the WHERE clause is optional in the data, then use OPTIONAL clause?
## Need to figure out which triple pattenrs oae
## Currently, only construct triples from non-inverse relationship. 

## Based on <http://linked.rvdata.us/page/award/100004>      
## r2r:Award rdfs:subClassOf ecglview:Award 

CONSTRUCT {
   ?X rdf:type ecgl:FundingAward .
   _:ar ecgl:isAgentRoleIn ?X .
   _:ar rdf:type ecgl:AgentRole .
   _:ar ecgl:hasAgentRoleType ecgl:funding_award_sponsor_role .
   _:ar ecgl:isPerformedBy ?Z .
   ?Z rdf:type ecgl:Organization . 
   ?X ecgl:isDescribedBy _:io .
   _:io rdf:type ecgl:FundingAwardInformationObject .
   _:io ecgl:hasAwardID ?ID .
   _:io ecgl:hasAwardTitle ?T .
   _:io ecgl:seeAlso ?W .
}
FROM <http://address-to-r2r-graph-mapped-to-view>
WHERE {
  ?X rdf:type ecglview:Award .
  ?X ecglview:hasSponsor ?Z.
  ?X dcterms:identifier ?ID .
  ?X dcterms:title ?T .
  ?X dcterms:source ?W .
}

## Based on <http://linked.rvdata.us/page/cruise/MGL0901>
## Only partially done .
## Event is for port arrival/departure?
## Fileset, Holding, : not yet done.
## cruise participant relationship is reified, but cruise operator and scheduler are not.

CONSTRUCT {
  ?C rdf:type ecgl:Cruise .
  ?C ecgl:isFundedBy ?AW .
  ?C ecgl:
  _:arop rdf:type ecgl:AgentRole .
  _:arop ecgl:isAgentRoleIn ?C .
  _:arop ecgl:hasAgentRoleType ecgl:cruise_operator_role
  _:arop ecgl:isPerformedBy ?OP .
  ?OP rdf:type ecgl:Organization .  
}
FROM <http://address-to-r2r-graph-mapped-to-view>
WHERE {
  ?C rdf:type ecglview:Cruise .
  ?C ecglview:hasAward ?AW .  
  
  ?C ecglview:hasOperator ?OP .
		?OP rdf:type ecglview:Organization .
  
  ?C ecglview:hasScheduler ?SCH .
		?SCH rdf:type ecglview:Organization .
		
  ?C ecglview:hasParticipation ?P .
		?P ecglview:hasAffiliationDuringCruise ?ORG .			
		?P ecglview:isPerformedBy ?PERS .			
		?P ecglview:hasRoleType ?ROL .		
  
  ?C ecglview:hasFileset ?FSET .  
  ?C ecglview:hasHolding ?HLD .  
  ?C ecglview:hasProduct ?PROD .  
  ?C ecglview:hasTrack ?TRACK .

  ?C ecglview:hasStartPortCall ?PC0 .
  ?PC0 ecglview:atPort ?PSTART .
  ?PC0 ecglview:hasTimeStamp ?TSTART .
  
  ?C ecglview:hasMidPortCall ?PCM .
  ?PCM ecglview:atPort ?PMID .
  ?PCM ecglview:hasTimeStamp ?TMID .
  
  ?C ecglview:hasEndPortCall ?PCN .
  ?PCN cgclview:atPort ?PEND .
  ?PCN ecglview:hasTimeStamp ?TEND .

  ?C ecglview:hasVessel ?V .  
  ?C ecglview:hasCruiseType ?TY .
  
  ?C dcterms:title ?T .
  ?C dcterms:identifier ?ID .
  ?C rdfs:label ?L .
  ?C rdfs:seeAlso ?W .
}

## http://linked.rvdata.us/page/device/100002
## r2r:Device rdfs:subClassOf ecglview:Device
CONSTRUCT {
}
FROM
WHERE {
  ?D ecglview:hasDeviceModel ?M .
  ?D ecglview:hasDeviceVendor ?VEND .
  ?D ecglview:hasDeviceTypeVocab ?T .
  ?D dcterms:identifier ?ID .
  ?D rdfs:label ?L .
  ?D rdf:type ecglview:Device
  ## ?D rdf:type ?NERCVOC .
}

## <http://linked.rvdata.us/page/event/100002781>
## This corresponds to arrival/departure from port

CONSTRUCT {
}
FROM <http://address-to-graph-view>
WHERE {
  ?E ecglview:hasPort ?P .
  ?E ecglview:hasPortActivityTypeVoc ?A .
  ?E ecglview:hasTimeStamp ?T .
  ?E rdfs:label ?L .
  ?E rdf:type ecglview:Event .
}

## <http://linked.rvdata.us/page/fileset/101244>
## r2r:Fileset rdfs:subClassOf ecglview:DigitalObjectRecord

CONSTRUCT {
} 
FROM
WHERE {
  ?FS ecglview:hasDevice ?DV .
  ?FS ecglview:hasFormat ?FMT .
  ?FS dcterms:identifier ?ID .
  ?FS rdfs:label ?L .
  ?FS dcterms:source ?S .
  ?FS dcterms:tableOfContents ?TOC .
  ?FS dcterms:title ?T .
  ?FS rdf:type ecglview:DigitalObjectRecord .
}

## http://linked.rvdata.us/page/format/100008
CONSTRUCT {
}
FROM
WHERE {
	?FMT dcterms:description ?DESC . ## R2R uses rdfs:description, which is not defined in RDFS
	?FMT dcterms:identifier ?ID .
	?FMT rdfs:label ?L .
	?FMT rdf:type ecglview:Format .
}

## http://linked.rvdata.us/page/geometry/100004
## are all geometries in R2R actually geo:Point?
CONSTRUCT {
}
FROM
WHERE {
	?GEOM dcterms:identifier ?ID .
	?GEOM rdfs:label ?L .
	?GEOM geo:lat ?LAT .
	?GEOM geo:long ?LONG .
	?GEOM rdf:type geo:Point .
}

## <http://linked.rvdata.us/page/holding/100035>
## r2r:Holding rdfs:subClassOf ecglview:DigitalObjectRecord

CONSTRUCT {
} 
FROM
WHERE {
  ?H ecglview:belongsToRepository ?REPO .
  ?H dcterms:identifier ?ID .
  ?H rdfs:label ?L .
  ?H dcterms:source ?S .
  ?H rdf:type ecglview:DigitalObjectRecord .
}

## http://linked.rvdata.us/page/model/100015
## What is r2r:Model?
CONSTRUCT {
}
FROM
WHERE {
  ?MOD ecglview:hasVendor ?VEND .
  ?MOD dcterms:identifier ?ID .
  ?MOD rdfs:label ?L .
  ## ?MOD rdf:type r2r:Model .
}


## Based on <http://linked.rvdata.us/page/organization/gov.nsf>
## r2r:Organization rdfs:subClassOf ecglview:Organization

CONSTRUCT {
  ?O rdf:type ecgl:Organization .
  ?O ecgl:isDescribedBy _:io .
  _:io rdf:type ecgl:OrganizationInformationObject .
  _:io ecgl:hasCanonicalName ?ID .
  _:io ecgl:alsoKnownAs ?L .
  _:io ecgl:alsoKnownAs ?M .  
}
FROM <http://address-to-r2r-graph-mapped-to-view>
WHERE {
  ?O rdf:type ecglview:Organization
  ?O dcterms:identifier ?ID .
  ?O rdfs:label ?L .
  ?O foaf:name ?M .
}


## http://linked.rvdata.us/page/participant/100005
## CONSTRUCT {
## }
## FROM
## WHERE {
##  ?P ecglview:hasAffiliation ?ORG .
##  ?P dcterms:identifier ?ID .
##  ?P rdfs:label ?L .
##  ?P ecglview:isPerformedBy ?PERS .
##  ?P ecglview:hasParticipantRoleTypeVoc ?ROL .
##  ?P rdf:type ecglview:AgentRole .
## }




## http://linked.rvdata.us/page/person/100275

CONSTRUCT {
}
FROM
WHERE {
  ?P dcterms:identifier ?ID .
  ?P rdfs:label ?L .
  ?P foaf:name ?M .
  ?P rdf:type ecglview:Person
}


## http://linked.rvdata.us/page/port/100006
## r2r:Port rdfs:subClassOf ecglview:Place
CONSTRUCT {
}
FROM
WHERE {
  ?PORT ecglview:hasCountryVoc ?C .
  ?PORT ecglview:hasGeometry ?GEOM .
  ?PORT dcterms:identifier ?ID .
  ?PORT rdfs:label ?L .
  ?PORT rdf:type ecglview:Place
}

## http://linked.rvdata.us/page/product/100014
## r2r:Product rdfs:subClassOf ecglview:DigitalObjectRecord
CONSTRUCT {
}
FROM
WHERE {
	?PROD dcterms:identifier ?ID .
	?PROD rdfs:label ?L .
	?PROD dcterms:source ?URL .
	?PROD rdf:type ecglview:DigitalObjectRecord .
}

## http://linked.rvdata.us/page/report/100455
CONSTRUCT {
}
FROM
WHERE {
	?PROD dcterms:identifier ?ID .
	?PROD rdfs:label ?L .
	?PROD dcterms:source ?URL .
	?PROD rdf:type ecglview:DigitalObjectRecord .
}

## http://linked.rvdata.us/page/repository/IMLGS
CONSTRUCT {
}
FROM
WHERE {
	?REPO dcterms:identifier ?ID .
	?REPO rdfs:label ?L .
	?REPO foaf:name ?M .  ## This is weird since a repository is not a person.
	?REPO rdf:type ecglview:Repository .
}

## http://linked.rvdata.us/page/track/MGL0901
## <http://www.opengis.net/ont/sf#LineString> rdfs:subClassOf ecglview:Geometry 
## Is every track a line string?
CONSTRUCT {
}
FROM
WHERE {
  ?TR geosparql:asWKT ?WKT .
  ?TR rdfs:label ?L .
  ?TR rdf:type ecglview:Geometry  
}

## http://linked.rvdata.us/page/vessel/33H3
## r2r:Vessel rdfs:subClassOf ecglview:Vessel

CONSTRUCT {
}
FROM
WHERE {
  ?V ecglview:hasVesselOperator ?OP .
  ?V ecglview:hasVesselOwner ?OW .
  ?V skos:exactMatch ?NERCVESSEL .
  ?V dcterms:identifier ?ID .
  ?V rdfs:label ?L .
  ?V rdf:type ecglview:Vessel  
  ?V rdf:type ?NERCVESSELTYPE .
}

